<!-- Controls -->
<div class="toolbar">
  <input [formControl]="search" placeholder="Search trips..." />

  <select (change)="setSort($any($event.target).value)">
    <option value="createdAt:desc" [selected]="sort==='createdAt:desc'">Newest</option>
    <option value="createdAt:asc" [selected]="sort==='createdAt:asc'">Oldest</option>
    <option value="price:asc" [selected]="sort==='price:asc'">Price ↑</option>
    <option value="price:desc" [selected]="sort==='price:desc'">Price ↓</option>
    <option value="name:asc" [selected]="sort==='name:asc'">Name A–Z</option>
    <option value="name:desc" [selected]="sort==='name:desc'">Name Z–A</option>
  </select>

  <input placeholder="Destination (exact)" [value]="dest" (change)="setDest($any($event.target).value)" />

  <button class="add-btn" (click)="toggleAdd()">{{ adding ? 'Cancel' : 'Add Trip' }}</button>

  <span class="spacer"></span>

  <!-- Logout moved here -->
  <button class="logout-btn" (click)="logout()">Logout</button>
</div>

<!-- Add form -->
<div *ngIf="adding" class="card">
  <form [formGroup]="addForm" (ngSubmit)="saveAdd()" class="grid">
    <input formControlName="name" placeholder="Title" required />
    <input formControlName="destination" placeholder="Destination" required />
    <input formControlName="price" type="number" placeholder="Price" />
    <input formControlName="date" type="date" />
    <textarea formControlName="description" placeholder="Description"></textarea>
    <div class="actions">
      <button type="submit" [disabled]="addForm.invalid">Save</button>
      <button type="button" (click)="toggleAdd()">Cancel</button>
    </div>
  </form>
</div>

<div *ngIf="loading" class="loading">Loading…</div>

<table class="results" *ngIf="!loading">
  <thead>
    <tr>
      <th>Title</th>
      <th>Location</th>
      <th>Description</th>
      <th>Price</th>
      <th class="actions-col">Actions</th>
    </tr>
  </thead>
  <tbody>
    <ng-container *ngFor="let t of trips">
      <tr *ngIf="editingId !== t._id">
        <td>{{ t.name }}</td>
        <td>{{ t.destination }}</td>
        <td>{{ t.description }}</td>
        <td>{{ t.price | currency }}</td>
        <td class="actions-col">
          <button (click)="startEdit(t)">Edit</button>
          <button (click)="deleteTrip(t)">Delete</button>
        </td>
      </tr>

      <!-- Edit row -->
      <tr *ngIf="editingId === t._id" class="edit-row">
        <td colspan="5">
          <form [formGroup]="editForm" (ngSubmit)="saveEdit(t)" class="grid">
            <input formControlName="name" placeholder="Title" required />
            <input formControlName="destination" placeholder="Destination" required />
            <input formControlName="price" type="number" placeholder="Price" />
            <input formControlName="date" type="date" />
            <textarea formControlName="description" placeholder="Description"></textarea>
            <div class="actions">
              <button type="submit" [disabled]="editForm.invalid">Save</button>
              <button type="button" (click)="cancelEdit()">Cancel</button>
            </div>
          </form>
        </td>
      </tr>
    </ng-container>
  </tbody>
</table>

<div class="paginator" *ngIf="total > 0">
  <button (click)="prevPage()" [disabled]="skip === 0">Prev</button>
  <span>{{ skip + 1 }}–{{ Math.min(skip + limit, total) }} of {{ total }}</span>
  <button (click)="nextPage()" [disabled]="skip + limit >= total">Next</button>
</div>
